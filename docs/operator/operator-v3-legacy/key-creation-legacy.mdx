---
title: Key Creation
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Admonition from '@theme/Admonition';
import useBaseUrl from '@docusaurus/useBaseUrl';

# Key Creation

After installing the Operator Service, you need to generate validator keystores and deposit data for your Vault, plus set up a wallet for handling validator registrations.

The Operator Service provides built-in functionality to generate all of the above.
Alternatively, you may use external tools such as [Wagyu Keygen ‚Üó](https://github.com/stake-house/wagyu-key-gen) to generate keystores, and wallets like [MetaMask ‚Üó](https://metamask.io/) or [MyEtherWallet ‚Üó](https://help.myetherwallet.com/en/articles/6512619-using-mew-offline).

This section walks you through the complete setup process using the Operator Service built-in tools.

<div style={{textAlign: 'center', margin: '2rem 0'}}>
  <pre style={{
    display: 'inline-block',
    textAlign: 'left',
    background: '#FFFFFF4D',
    color: '#018970',
    padding: '2rem',
    borderRadius: '12px',
    fontSize: '14px',
    fontFamily: 'Monaco, monospace',
    boxShadow: '0 10px 30px rgba(1,137,112,0.2)',
    lineHeight: '1.8'
  }}>
    <strong style={{fontSize: '16px', borderBottom: '2px solid #018970', paddingBottom: '0.5rem', display: 'inline-block', marginBottom: '1rem'}}>üîë Key Generation Flow</strong>

     üìù Mnemonic
       ‚îú‚îÄ üîê Validator Keys &rarr; üìÅ Keystores + üìÑ Deposit Data &rarr; ‚úÖ Import to Client
       ‚îî‚îÄ üí≥ Wallet &rarr; üí∞ Fund with ETH &rarr; üì§ Upload Deposit Data &rarr; üöÄ Register Validators
  </pre>
</div>

## Step 1: Initialize Mnemonic

:::custom-notes[Initialize Configuration]
  Run the `init` command to set up your mnemonic used to derive your validator keys.
:::

For example, if running Operator Service from binary:

```bash
./operator init
```

Follow the command prompts.

<details className="custom-details">
<summary>Example Output</summary>

```
Enter the network name (mainnet, hoodi, gnosis, chiado) [mainnet]:
Enter your vault address: 0x3320a...68
Choose your mnemonic language (chinese_simplified, chinese_traditional, czech, english, italian, korean, portuguese, spanish) [english]:
This is your seed phrase. Write it down and store it safely, it is the ONLY way to recover your validator keys.

pumpkin anxiety private salon inquiry ....


Press any key when you have written down your mnemonic.

Please type your mnemonic (separated by spaces) to confirm you have written it down

: pumpkin anxiety private salon inquiry ....

done.
Successfully initialized configuration for vault 0x3320a...68
```

</details>

:::custom-warning[Important Security Notice]
  Keep your mnemonic safe. It is the only way to recover your validator keys.
:::

## Step 2: Generate Validator Keys

Generate validator keystores and deposit data from your mnemonic using:

```bash
./operator create-keys
```

Follow the command prompts.

<details className="custom-details">
<summary>Example Output</summary>
```
Enter the vault address: 0x3320a...68
Enter the number of the validator keys to generate: 10
Enter the mnemonic for generating the validator keys: pumpkin anxiety private salon inquiry ....
Creating validator keys:    [####################################]  10/10
Generating deposit data JSON    [####################################]  10/10
Exporting validator keystores    [####################################]  10/10

Done. Generated 10 keys for 0x3320a...68 vault.
Keystores saved to /home/user/.stakewise/0x3320a...68/keystores file
Deposit data saved to /home/user/.stakewise/0x3320a...68/keystores/deposit_data.json file
```
</details>

:::custom-notes[Generated Files]
  - **Keystores**: Saved to `~/.stakewise/0x[vault-address]/keystores`
  - **Deposit Data**: Saved to `~/.stakewise/0x[vault-address]/keystores/deposit_data.json`
  - **Password**: Stored in `password.txt` within the keystores folder
:::

:::custom-warning[Deposit Data Requirements]
The deposit data file must be created using the Vault contract as the withdrawal address. The Operator Service automatically uses your Vault address for this purpose. If using external tools, ensure the withdrawal address matches your Vault contract address.
:::

:::custom-warning[Important]
  Protect `password.txt` as carefully as your keystores ‚Äî anyone with it can access your keys.
:::

You can always add more validator keys to your Vault. For that, you need to generate new validator keys and upload the new deposit data file (which will overwrite the existing one).

## Step 3: Set Up Wallet

Create a wallet for validator registrations and gas payments:

```bash
./operator create-wallet
```

<details className="custom-details">
<summary>Example Output</summary>
```
Enter the vault address: 0x3320a...68
Enter the mnemonic for generating the wallet: pumpkin anxiety private salon inquiry ...
Done. The wallet and password saved to /home/user/.stakewise/0x3320a...68/wallet directory. The wallet address is: 0x239B...e3Cc
```
</details>

You may reuse the same mnemonic as your validator keys or generate a separate one for added security.

:::custom-warning[Wallet Balance Warning]
  Fund your wallet with ETH (or xDAI on Gnosis) to cover gas:

    - Each validator registration costs ~0.01 ETH at 30 Gwei gas price
    - Check current gas prices at [Etherscan Gas Tracker ‚Üó](https://etherscan.io/gastracker)
    - Monitor balance regularly to prevent registration failures
:::

## Step 4: Upload Deposit Data to Vault

Once you have created your validator keys and deposit data file, you need to upload the deposit data file to the Vault. This process connects your node to the Vault and can only be done by the [Vault Admin or Keys Manager ‚Üó](https://docs-v3.stakewise.io/protocol-overview-in-depth/vaults#governance-and-management).

:::custom-info[Multiple Operators]
If there is more than one node operator in a Vault, you first need to merge all operator deposit data files into a single file using the `merge-deposit-data` command before uploading.
:::

<Tabs groupId="upload-methods">
  <TabItem value="ui" label="StakeWise UI" default>
    1. Connect with your wallet and head to the [Operate page ‚Üó](https://app.stakewise.io/operate)
    2. Select the Vault you want to upload the deposit data file to
    3. In the upper right corner, click on **"Settings"** and open the **"Deposit Data"** tab
    4. Upload the deposit data file either by dragging and dropping the file, or clicking to choose the file via your file browser
    5. Click **Save** and sign the transaction in your wallet

    :::custom-notes[UI Access]
    The "Settings" button is only visible to the Vault Admin or Keys Manager.
    :::
  </TabItem>

  <TabItem value="operator" label="Operator Service">
    Calculate the deposit data Merkle tree root with the following command:

    ```bash
    ./operator get-validators-root
    ```

    ```
    Enter the vault address: 0xeEFFFD4C23D2E8c845870e273861e7d60Df49663
    The validator deposit data Merkle tree root: 0x50437ed72066c1a09ee85978f168ac7c58fbc9cd4beb7962c13e68e7faac26d7
    ```

    Then upload the root to your Vault contract:

    - **Vault version 1**: Call `setValidatorsRoot` method of Vault contract
    - **Vault version 2+**: Call `setDepositDataRoot` method of `DepositDataRegistry` contract

    Find the `DepositDataRegistry` contract addresses:
    - [Ethereum Mainnet ‚Üó](https://etherscan.io/address/0x75AB6DdCe07556639333d3Df1eaa684F5735223e)
    - [Gnosis Chain ‚Üó](https://gnosisscan.io/address/0x58e16621B5c0786D6667D2d54E28A20940269E16)
  </TabItem>
</Tabs>

## Step 5: Import Validator Keys

Upload your keystores into your consensus client:

1. Locate your keystores in `~/.stakewise/0x[vault-address]/keystores`
2. Follow your consensus client's guide for importing keys
3. Use the password from `password.txt` file
4. Set the fee recipient to your Vault's fee recipient address

:::custom-info[Fee Recipient Address]
Found in your Vault's "Details" section on the StakeWise interface.
:::

## Alternative Key Management

Validator keystores don't need to be stored directly in the Operator Service. You can instead use:

- **[Remote Signer ‚Üó](./alternative-key-creation/remote-signer)** - Sign deposit/exit messages via a remote signer
- **[HashiCorp Vault ‚Üó](./alternative-key-creation/hashicorp-vault)** - Load keys from a remote Vault instance
- **[API Mode ‚Üó](./alternative-key-creation/api-mode)** - Run Operator as API service with external key management

## Additional Commands

### Add More Validator Keys

You can always add more validator keys to your Vault:

1. Generate new keys using `create-keys`
2. Upload the new deposit data file (this overwrites the existing file)
3. Import the new keystores to your validator clients

:::custom-warning[Overwrite Warning]
Uploading a new deposit data file will overwrite the existing file and consequently overwrite previously unused validator keys.
:::

### Merge Deposit Data Files

For Vaults with multiple operators, merge deposit data files:

```bash
./operator merge-deposit-data
```

### Recover Validator Keystores

You can recover validator keystores that are active. The recovery process will detect validators associated with your Vault address.

:::custom-warning[Safety Requirements]
  Before recovering keystores:
  - **Stop all validators** - Ensure no validators are running with these keystores
  - **Wait at least 2 epochs** - Allow time to pass to avoid slashing
  - **Protect mnemonic** - Your seed phrase can generate all validator keys
:::

```bash
./operator recover
```

<details className="custom-details">
<summary>Example Output</summary>
```
Enter the mnemonic for generating the validator keys: [Your Mnemonic Here]
Enter your vault address: 0x3320ad928c20187602a2b2c04eeaa813fa899468
Enter the comma separated list of API endpoints for execution nodes: https://example.com
Enter the comma separated list of API endpoints for consensus nodes: https://example.com
Enter the network name: hoodi
Found 24 validators, recovering...
Generating keystores [####################################] 100%
Keystores for vault 0x3320ad928c20187602a2b2c04eeaa813fa899468 successfully recovered to /home/user/.stakewise/keystores
```
</details>

## Advanced Configuration

### Environment Variables

Operator Service can be configured via environment variables instead of CLI flags.
Copy [this example file ‚Üó](https://github.com/stakewise/v3-operator/blob/master/.env.example) and save it as `.env`.

```bash
# Load environment variables
export $(grep -v '^#' .env | xargs)

# Verify they're loaded
env
```

### Gas Fee Limits

Protect against excessive gas costs by setting maximum fees:

```bash
./operator start --max-fee-per-gas-wei=100000000000  # 100 Gwei max
```

### CPU Optimization

Reduce CPU load during key operations:

```bash
# Use half your CPU cores (recommended)
./operator create-keys --pool-size=2
```
:::custom-tips[Performance Tip]
  Setting `--pool-size` to half your CPU cores ensures smooth node operation during keystore operations.
:::

## Next Steps

With your keys, deposit data, and wallet prepared, continue to [Getting Started ‚Üó](getting-started) to configure your Vault permissions and launch the Operator Service.

:::custom-info[For consensus client documentation, see:]
[Lighthouse ‚Üó](https://lighthouse-book.sigmaprime.io/intro.html) ‚Ä¢ [Prysm ‚Üó](https://docs.prylabs.network/) ‚Ä¢ [Teku ‚Üó](https://docs.teku.consensys.io/) ‚Ä¢ [Nimbus ‚Üó](https://nimbus.guide/) ‚Ä¢ [Lodestar ‚Üó](https://chainsafe.github.io/lodestar/)
:::